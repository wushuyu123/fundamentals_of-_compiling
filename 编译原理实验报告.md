# 2020-2021学年第2学期

## 实 验 报 告

![1685760289103](image/编译原理实验报告/1685760289103.png)

* 课程名称：编程语言原理与变异
* 实验项目：期末大作业
* 专业班级：计算机2001
* 学生学号：32001111、32001128
* 学生姓名：陈家鹏、吴书雨
* 实验指导教师：郭鸣

| 学号     | 姓名   | 班级       | 权重 | 任务     |
| -------- | ------ | ---------- | ---- | -------- |
| 32001111 | 陈家鹏 | 计算机2001 | 0.95 | 见GitHub |
| 32001128 | 吴书雨 | 计算机2001 | 0.95 | 见GitHub |

## 项目自评等级:(1-5) 请根据自己项目情况填写下表

| 词法                                     | 评分       | 备注 |
| ---------------------------------------- | ---------- | ---- |
| 类型名称以大写开头                       | ⭐⭐⭐⭐⭐ |      |
| 变量名以小写开头                         |            |      |
| 两个下划线开头的名字__是内部保留，不允许 |            |      |
| 注释（* *）                              | ⭐⭐       |      |
| Float                                    | ⭐         |      |

| 语法            | 评分     | 备注 |
| --------------- | -------- | ---- |
| I++ I-- ++I --I | ⭐⭐⭐⭐ |      |
| += -= *= /= %=  |          |      |

## 项目说明

+ 项目 是基于现有的microc代码

  - 改进 xxx模块 功能1
  - 改进 xxx模块 功能2
  - 。。。。

- 项目 独立开发
  - 独立开发了 xx 模块
  - 。。。。

## 解决技术要点说明

### 解释器

#### 1. 解决类型检查，关键代码与步骤如下

类型首字母大写通过自定义匹配实现，变量首字母大写通过正则表达式判断，

1. 步骤

   + 修改Clex.fsl 中关键词信息，正则表达式匹配首字母大写变量

   ![image-20230602101118995](imgs/01.png)
2. 测试

   测试代码

   ![image-20230529103313437](imgs/small_letter.png)

类型首字母大写测试

如果类型首字母小写，将出现报错

![image-20230529103225009](imgs/small_letter_1.png)

如果首字母大写（代码的注释部分），输出100

![image-20230529101549579](imgs/small_letter_2.png)

#### 2. 实现自定义注释 （  （*   *）），关键代码与步骤如下

1. 实现
   修改Clex.fls文件。

   ![1685760736277](image/编译原理实验报告/1685760736277.png)
2. 测试

   ![1685759774252](image/编译原理实验报告/1685759774252.png)

   ![1685760903371](image/编译原理实验报告/1685760903371.png)

#### 3. 未完全实现Float类型，部分关键代码与步骤如下

1. 实验
   在Absyn.fs中增加float类型

   ![1685761122147](image/编译原理实验报告/1685761122147.png)
   在Clex.fsl 中增加关键词信息FLOAT、正则表达式提取浮点数

   ![1685761213763](image/编译原理实验报告/1685761213763.png)增加CPar.fsy中token的定义、FLOAT类型

   ![1685761363373](image/编译原理实验报告/1685761363373.png)

   ![1685761286771](image/编译原理实验报告/1685761286771.png)

   在interp.fs中增加第三种print类型，并在CPar.fsy中声明

   ![1685761440408](image/编译原理实验报告/1685761440408.png)

   ![1685761508672](image/编译原理实验报告/1685761508672.png)
2. 测试

   ![1685761546780](image/编译原理实验报告/1685761546780.png)

   ![1685761584529](image/编译原理实验报告/1685761584529.png)

   ![1686490070633](image/编译原理实验报告/1686490070633.png)

#### 4.解决自增自减运算符（i++,i--,--i,++i）问题，关键代码与步骤如下

1. 实现

   1. 在Absyn.fs中添加表达式

      ![image-20230602101933393](imgs/02.png)

      2.在CLex.fsl中添加 ++ 和 -- 的词法

      ![image-20230602102112782](imgs/03.png)

   3.在CPar.fsy中添加token：SELFPLUS、 SELFMINUS；运算优先级；非左值情况定义

![image-20230602102338989](imgs/04.png)

    4.测试代码

    ![image-20230602102526025](imgs/test++--.png)

![image-20230602102633363](imgs/run++--.png)

#### 5.解决 +=，-=，*=，/= 问题，关键代码与步骤如下

1. 实现

   1. 在Clex.fsl中加入新规则

      ![1685929324158](image/编译原理实验报告/1685929324158.png)
   2. CPar.fsy中定义token，增加非左值情况。

      ![1685929343211](image/编译原理实验报告/1685929343211.png)
   3. 在Absyn.fs中加入新的expr

      ![1685929379014](image/编译原理实验报告/1685929379014.png)
   4. Interp.c中加入新的eval

      ![1685929355519](image/编译原理实验报告/1685929355519.png)
2. 测试

   ![1685929392724](image/编译原理实验报告/1685929392724.png)

   ![1685929413175](image/编译原理实验报告/1685929413175.png)

   ![1686490222379](image/编译原理实验报告/1686490222379.png)

#### 6.解决Switch Case问题，关键代码与步骤如下

1. 实现

   在CLex.fsl中新增

   ![1686490427584](https://file+.vscode-resource.vscode-cdn.net/d%3A/Work/bianyiyuanli/dazuoye/fundamentals_of_compiling/image/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/1686490427584.png)

   在CPar.fsy中新增token(SWITCH、CASE、DEFAULT);

   ![1686490537000](image/编译原理实验报告/1686490537000.png)

   1. 增加StmtM

      ![1686491739311](image/编译原理实验报告/1686491739311.png)
   2. 增加StmtS

      ![1686491775042](image/编译原理实验报告/1686491775042.png)

   在Absyn.fs中

   1. 新增stmt

      ![1686490568434](image/编译原理实验报告/1686490568434.png)

   在Interp.c中加入新的exec

   ![1686491808132](image/编译原理实验报告/1686491808132.png)
2. 测试

   ![1686490582835](image/编译原理实验报告/1686490582835.png)

   ![1686490609592](image/编译原理实验报告/1686490609592.png)

   ![1686490642392](image/编译原理实验报告/1686490642392.png)



#### 7.解决Do While问题，关键代码与步骤如下

1. 实现

   1. 在CLex.fsl中新增

      ```F#
      | "do"      -> DO
      ```
   2. 在CPar.fsy中新增token(DO);

      1. 增加StmtM

      ![1686491921178](image/编译原理实验报告/1686491921178.png)
   3. 在Absyn.fs中

      1. 新增stmt

         ![1686491883951](image/编译原理实验报告/1686491883951.png)
   4. 在Interp.c中加入新的exec

   ![1686491865940](image/编译原理实验报告/1686491865940.png)
2. 测试

    ![1686491949814](image/编译原理实验报告/1686491949814.png)

![1686491999413](image/编译原理实验报告/1686491999413.png)![1686492053572](image/编译原理实验报告/1686492053572.png)


#### 8.解决Do Until问题，关键代码与步骤如下

1. 实现
   1. 在CLex.fsl中新增

      ![1686492777253](image/编译原理实验报告/1686492777253.png)
   2. 在CPar.fsy中新增token(UNTIL);

      1. 增加StmtM

         ![1686492871690](image/编译原理实验报告/1686492871690.png)
   3. 在Absyn.fs中

      1. 新增stmt

      ![1686492884546](image/编译原理实验报告/1686492884546.png)
   4. 在Interp.c中加入新的exec

      ![1686492926954](image/编译原理实验报告/1686492926954.png)
2. 测试

![1686492964036](image/编译原理实验报告/1686492964036.png)

![1686492978880](image/编译原理实验报告/1686492978880.png)

![1686493022092](image/编译原理实验报告/1686493022092.png)

### 编译器

#### 5.解决 +=，-=，*=，/= 问题，关键代码与步骤如下

1. 实现

   在comp中加入cExpr

   ![1686493565561](image/编译原理实验报告/1686493565561.png)
2. 测试

# 心得体会

+ 大作业开发过程心得
+ 本课程建议
